-- -*- mode: SQL; -*-
-- Molly sqlite schema.
-- Copyright (c) 2018 Acke, see LICENSE file for allowable usage.

CREATE TABLE mkey (
	mkeyid		INTEGER PRIMARY KEY,
        string		TEXT NOT NULL,
        yearmade	INTEGER,
        UNIQUE (string, yearmade)
        );

CREATE TABLE movie (
        movieid		INTEGER PRIMARY KEY,
        title		TEXT NOT NULL,
        yearmade	INTEGER,
        notes		TEXT,
        whenadded	INTEGER NOT NULL,
        mkeyid		INTEGER REFERENCES mkey
        );

CREATE TABLE sync (
	syncid		INTEGER PRIMARY KEY,
        whensynced	INTEGER UNIQUE NOT NULL
        );

CREATE TABLE rank (
        rankid		INTEGER PRIMARY KEY,
        indexnum	INTEGER NOT NULL,
        movieid		INTEGER NOT NULL,
        asat		INTEGER NOT NULL,
        FOREIGN KEY (movieid) REFERENCES movie,
        FOREIGN KEY (asat) REFERENCES sync(whensynced)
        );

CREATE TABLE location (
        locationid	INTEGER PRIMARY KEY,
        pathname	TEXT NOT NULL,
        parentid	REFERENCES location
        );

CREATE TABLE mediafile (
        mediafileid	INTEGER PRIMARY KEY,
        filename	TEXT NOT NULL,
        locationid	INTEGER NOT NULL REFERENCES location,
        mkeyid		INTEGER REFERENCES mkey,
        UNIQUE (locationid, filename)
        );
